<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración de Votaciones</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .estado-votacion {
            padding: 10px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }
        .activa {
            background-color: #d4edda;
            color: #155724;
        }
        .inactiva {
            background-color: #f8d7da;
            color: #721c24;
        }
        .config-panel {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="datetime-local"] {
            padding: 8px;
            width: 100%;
            max-width: 300px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0069d9;
        }
    </style>
</head>
<body>
    <h1>Administración de Votaciones</h1>
    
    <div id="estadoVotacion" class="estado-votacion">
        Estado de la votación no disponible
    </div>
    
    <div class="config-panel">
        <h2>Configuración de Tiempo</h2>
        <div class="form-group">
            <label for="horaInicio">Hora de Inicio:</label>
            <input type="datetime-local" id="horaInicio">
        </div>
        <div class="form-group">
            <label for="horaFin">Hora de Fin:</label>
            <input type="datetime-local" id="horaFin">
        </div>
        <button onclick="guardarConfiguracion()">Guardar Configuración</button>
    </div>
    
    <!-- Agregar este panel después del de Configuración de Tiempo -->
    <div class="config-panel">
        <h2>Límites de Votación</h2>
        <div class="form-group">
            <label for="votosMinimos">Votos Mínimos Requeridos:</label>
            <input type="number" id="votosMinimos" min="0" placeholder="Ej: 100">
        </div>
        <div class="form-group">
            <label for="votosMaximos">Votos Máximos Permitidos:</label>
            <input type="number" id="votosMaximos" min="1" placeholder="Ej: 500">
        </div>
        <button onclick="guardarLimitesVotos()">Guardar Límites</button>
        
        <div id="estadoLimites" style="margin-top: 15px; padding: 10px; border-radius: 5px;">
            <!-- Aquí se mostrará el estado actual -->
        </div>
    </div>

    <!-- Reemplazar la tabla estática por una dinámica -->
    <div id="conteoVotos">
        <h2>Conteo de Votos</h2>
        <table>
            <thead>
                <tr>
                    <th>Representante</th>
                    <th>Votos</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas se generarán dinámicamente -->
            </tbody>
        </table>
    </div>
    <!-- Agregar esta sección antes del div de Acciones Administrativas -->
    <!-- Panel de Gestión de Candidatos actualizado -->
    <div class="config-panel">
        <h2>Gestión de Candidatos</h2>
        
        <div id="listaCandidatosAdmin">
            <h3>Candidatos Actuales</h3>
            <ul id="candidatosLista">
                <!-- Los candidatos se cargarán dinámicamente -->
            </ul>
        </div>
        
        <div class="form-group">
            <h3>Agregar/Editar Candidato</h3>
            
            <label for="nombreCandidato">Nombre Completo:</label>
            <input type="text" id="nombreCandidato" placeholder="Ej: Juan Pérez">
            
            <label for="esloganCandidato">Eslogan de Campaña:</label>
            <textarea id="esloganCandidato" rows="3" placeholder="Ej: ¡Por una educación más inclusiva!"></textarea>
            
            <label for="fotoCandidato">Foto del Candidato:</label>
            <input type="file" id="fotoCandidato" accept="image/*">
            <small>Solo imágenes JPG/PNG (300x300px recomendado)</small>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="agregarEditarCandidato()" id="btnAccionCandidato">Agregar</button>
                <button onclick="cancelarEdicion()" id="btnCancelarEdicion" style="display: none; background-color: #6c757d;">Cancelar</button>
            </div>
        </div>
    </div>
    <div class="config-panel">
        <h2>Acciones Administrativas</h2>
        <button onclick="reiniciarVotos()">Reiniciar Votos</button>
        <button onclick="exportarDatos()">Exportar Datos</button>
    </div>

    <script>
        // Función para guardar la configuración del tiempo
        function guardarConfiguracion() {
            const inicio = document.getElementById('horaInicio').value;
            const fin = document.getElementById('horaFin').value;
            
            if (!inicio || !fin) {
                alert('Por favor complete ambas fechas');
                return;
            }
            
            if (new Date(fin) <= new Date(inicio)) {
                alert('La hora de fin debe ser posterior a la hora de inicio');
                return;
            }
            
            // Llamar a la función de configuración
            configurarTiempoVotacion(inicio, fin);
        }
        
        // Función para reiniciar los votos
        function reiniciarVotos() {
            if (confirm('¿Está seguro que desea reiniciar todos los votos? Esta acción no se puede deshacer.')) {
                localStorage.setItem('votosRegistrados', JSON.stringify([]));
                cargarTablaVotos();
                alert('Votos reiniciados correctamente');
            }
        }
        
        // Función para exportar datos
        function exportarDatos() {
            const votos = JSON.parse(localStorage.getItem('votosRegistrados')) || [];
            const config = JSON.parse(localStorage.getItem('configVotacion')) || {};
            
            const datos = {
                configuracion: config,
                votos: votos,
                conteo: contarVotos(),
                fechaExportacion: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(datos, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `votacion_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
    
    <script src="administradores.js"></script>
</body>
</html>